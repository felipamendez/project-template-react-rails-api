{"version":3,"sources":["../../../src/lib/series/CandlestickSeries.js"],"names":["CandlestickSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","className","wickClassName","candleClassName","xScale","yScale","chartConfig","plotData","xAccessor","candleData","getCandleData","getWicksSVG","getCandlesSVG","clip","getAxisCanvas","Component","propTypes","PropTypes","string","wickProps","object","candleProps","widthRatio","number","width","oneOfType","func","classNames","fill","stroke","wickStroke","yAccessor","bool","defaultProps","open","d","high","low","close","plotDataLengthBarWidth","candleStrokeWidth","opacity","wicks","map","each","idx","wick","x","y1","y2","y3","y4","candles","y","height","wickNest","key","entries","forEach","outer","values","strokeStyle","fillStyle","fillRect","candleNest","strokeKey","strokeValues","lineWidth","inner","strokeRect","wickStrokeProp","fillProp","strokeProp","widthFunctor","trueOffset","offset","Math","round","floor","i","length","ohlc","max","abs","push","direction"],"mappings":"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","file":"CandlestickSeries.js","sourcesContent":["\n\nimport { nest } from \"d3-collection\";\n\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport GenericChartComponent from \"../GenericChartComponent\";\nimport { getAxisCanvas } from \"../GenericComponent\";\n\nimport {\n\thexToRGBA, isDefined, functor, plotDataLengthBarWidth, head\n} from \"../utils\";\n\nclass CandlestickSeries extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.renderSVG = this.renderSVG.bind(this);\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\n\t}\n\tdrawOnCanvas(ctx, moreProps) {\n\t\tdrawOnCanvas(ctx, this.props, moreProps);\n\t}\n\trenderSVG(moreProps) {\n\t\tconst { className, wickClassName, candleClassName } = this.props;\n\t\tconst { xScale, chartConfig: { yScale }, plotData, xAccessor } = moreProps;\n\n\t\tconst candleData = getCandleData(this.props, xAccessor, xScale, yScale, plotData);\n\n\t\treturn <g className={className}>\n\t\t\t<g className={wickClassName} key=\"wicks\">\n\t\t\t\t{getWicksSVG(this.props, candleData)}\n\t\t\t</g>\n\t\t\t<g className={candleClassName} key=\"candles\">\n\t\t\t\t{getCandlesSVG(this.props, candleData)}\n\t\t\t</g>\n\t\t</g>;\n\t}\n\n\trender() {\n\t\tconst { clip } = this.props;\n\t\treturn <GenericChartComponent\n\t\t\tclip={clip}\n\t\t\tsvgDraw={this.renderSVG}\n\t\t\tcanvasDraw={this.drawOnCanvas}\n\t\t\tcanvasToDraw={getAxisCanvas}\n\t\t\tdrawOn={[\"pan\"]}\n\t\t/>;\n\t}\n}\n\nCandlestickSeries.propTypes = {\n\tclassName: PropTypes.string,\n\twickClassName: PropTypes.string,\n\twickProps: PropTypes.object,\n\tcandleClassName: PropTypes.string,\n\tcandleProps: PropTypes.object,\n\twidthRatio: PropTypes.number,\n\twidth: PropTypes.oneOfType([\n\t\tPropTypes.number,\n\t\tPropTypes.func\n\t]),\n\tclassNames: PropTypes.oneOfType([\n\t\tPropTypes.func,\n\t\tPropTypes.string\n\t]),\n\tfill: PropTypes.oneOfType([\n\t\tPropTypes.func,\n\t\tPropTypes.string\n\t]),\n\tstroke: PropTypes.oneOfType([\n\t\tPropTypes.func,\n\t\tPropTypes.string\n\t]),\n\twickStroke: PropTypes.oneOfType([\n\t\tPropTypes.func,\n\t\tPropTypes.string\n\t]),\n\tyAccessor: PropTypes.func,\n\tclip: PropTypes.bool,\n};\n\nCandlestickSeries.defaultProps = {\n\tclassName: \"react-stockcharts-candlestick\",\n\twickClassName: \"react-stockcharts-candlestick-wick\",\n\twickProps: {},\n\tcandleClassName: \"react-stockcharts-candlestick-candle\",\n\tcandleProps: {},\n\tyAccessor: d => ({ open: d.open, high: d.high, low: d.low, close: d.close }),\n\tclassNames: d => d.close > d.open ? \"up\" : \"down\",\n\twidth: plotDataLengthBarWidth,\n\twickStroke: \"#000000\",\n\t// wickStroke: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\n\tfill: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\n\t// stroke: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\n\tstroke: \"#000000\",\n\tcandleStrokeWidth: 0.5,\n\t// stroke: \"none\",\n\twidthRatio: 0.8,\n\topacity: 0.5,\n\tclip: true,\n};\n\nfunction getWicksSVG(props, candleData) {\n\tconst { wickProps } = props;\n\tconst wicks = candleData\n\t\t.map((each, idx) => {\n\t\t\tconst d = each.wick;\n\t\t\treturn <path key={idx}\n\t\t\t\tclassName={each.className}\n\t\t\t\tstroke={d.stroke}\n\t\t\t\td={`M${d.x},${d.y1} L${d.x},${d.y2} M${d.x},${d.y3} L${d.x},${d.y4}`}\n\t\t\t\t{...wickProps} />;\n\t\t});\n\n\treturn wicks;\n}\n\nfunction getCandlesSVG(props, candleData) {\n\n\t/* eslint-disable react/prop-types */\n\tconst { opacity, candleStrokeWidth, candleProps } = props;\n\t/* eslint-enable react/prop-types */\n\n\tconst candles = candleData.map((d, idx) => {\n\t\tif (d.width <= 1)\n\t\t\treturn (\n\t\t\t\t<line className={d.className} key={idx}\n\t\t\t\t\tx1={d.x} y1={d.y} x2={d.x} y2={d.y + d.height}\n\t\t\t\t\tstroke={d.fill}\n\t\t\t\t\t{...candleProps}\n\t\t\t\t/>\n\t\t\t);\n\t\telse if (d.height === 0)\n\t\t\treturn (\n\t\t\t\t<line key={idx}\n\t\t\t\t\tx1={d.x} y1={d.y} x2={d.x + d.width} y2={d.y + d.height}\n\t\t\t\t\tstroke={d.fill}\n\t\t\t\t\t{...candleProps}\n\t\t\t\t/>\n\t\t\t);\n\t\treturn (\n\t\t\t<rect key={idx} className={d.className}\n\t\t\t\tfillOpacity={opacity}\n\t\t\t\tx={d.x} y={d.y} width={d.width} height={d.height}\n\t\t\t\tfill={d.fill} stroke={d.stroke} strokeWidth={candleStrokeWidth}\n\t\t\t\t{...candleProps}\n\t\t\t/>\n\t\t);\n\t});\n\treturn candles;\n}\n\nfunction drawOnCanvas(ctx, props, moreProps) {\n\tconst { opacity, candleStrokeWidth } = props;\n\tconst { xScale, chartConfig: { yScale }, plotData, xAccessor } = moreProps;\n\n\t// const wickData = getWickData(props, xAccessor, xScale, yScale, plotData);\n\tconst candleData = getCandleData(props, xAccessor, xScale, yScale, plotData);\n\n\tconst wickNest = nest()\n\t\t.key(d => d.wick.stroke)\n\t\t.entries(candleData);\n\n\twickNest.forEach(outer => {\n\t\tconst { key, values } = outer;\n\t\tctx.strokeStyle = key;\n\t\tctx.fillStyle = key;\n\t\tvalues.forEach(each => {\n\t\t\t/*\n\t\t\tctx.moveTo(d.x, d.y1);\n\t\t\tctx.lineTo(d.x, d.y2);\n\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(d.x, d.y3);\n\t\t\tctx.lineTo(d.x, d.y4);\n\t\t\tctx.stroke(); */\n\t\t\tconst d = each.wick;\n\n\t\t\tctx.fillRect(d.x - 0.5, d.y1, 1, d.y2 - d.y1);\n\t\t\tctx.fillRect(d.x - 0.5, d.y3, 1, d.y4 - d.y3);\n\t\t});\n\t});\n\n\t// const candleData = getCandleData(props, xAccessor, xScale, yScale, plotData);\n\n\tconst candleNest = nest()\n\t\t.key(d => d.stroke)\n\t\t.key(d => d.fill)\n\t\t.entries(candleData);\n\n\n\tcandleNest.forEach(outer => {\n\t\tconst { key: strokeKey, values: strokeValues } = outer;\n\t\tif (strokeKey !== \"none\") {\n\t\t\tctx.strokeStyle = strokeKey;\n\t\t\tctx.lineWidth = candleStrokeWidth;\n\t\t}\n\t\tstrokeValues.forEach(inner => {\n\t\t\tconst { key, values } = inner;\n\t\t\tconst fillStyle = head(values).width <= 1\n\t\t\t\t? key\n\t\t\t\t: hexToRGBA(key, opacity);\n\t\t\tctx.fillStyle = fillStyle;\n\n\t\t\tvalues.forEach(d => {\n\t\t\t\tif (d.width <= 1) {\n\t\t\t\t\t// <line className={d.className} key={idx} x1={d.x} y1={d.y} x2={d.x} y2={d.y + d.height}/>\n\t\t\t\t\t/*\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.moveTo(d.x, d.y);\n\t\t\t\t\tctx.lineTo(d.x, d.y + d.height);\n\t\t\t\t\tctx.stroke();\n\t\t\t\t\t*/\n\t\t\t\t\tctx.fillRect(d.x - 0.5, d.y, 1, d.height);\n\t\t\t\t} else if (d.height === 0) {\n\t\t\t\t\t// <line key={idx} x1={d.x} y1={d.y} x2={d.x + d.width} y2={d.y + d.height} />\n\t\t\t\t\t/*\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.moveTo(d.x, d.y);\n\t\t\t\t\tctx.lineTo(d.x + d.width, d.y + d.height);\n\t\t\t\t\tctx.stroke();\n\t\t\t\t\t*/\n\t\t\t\t\tctx.fillRect(d.x, d.y - 0.5, d.width, 1);\n\t\t\t\t} else {\n\t\t\t\t\t/*\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.rect(d.x, d.y, d.width, d.height);\n\t\t\t\t\tctx.closePath();\n\t\t\t\t\tctx.fill();\n\t\t\t\t\tif (strokeKey !== \"none\") ctx.stroke();\n\t\t\t\t\t*/\n\t\t\t\t\tctx.fillRect(d.x, d.y, d.width, d.height);\n\t\t\t\t\tif (strokeKey !== \"none\") ctx.strokeRect(d.x, d.y, d.width, d.height);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t});\n}\n/*\nfunction getWickData(props, xAccessor, xScale, yScale, plotData) {\n\n\tconst { classNames: classNameProp, wickStroke: wickStrokeProp, yAccessor } = props;\n\tconst wickStroke = functor(wickStrokeProp);\n\tconst className = functor(classNameProp);\n\tconst wickData = plotData\n\t\t\t.filter(d => isDefined(yAccessor(d).close))\n\t\t\t.map(d => {\n\t\t\t\t// console.log(yAccessor);\n\t\t\t\tconst ohlc = yAccessor(d);\n\n\t\t\t\tconst x = Math.round(xScale(xAccessor(d))),\n\t\t\t\t\ty1 = yScale(ohlc.high),\n\t\t\t\t\ty2 = yScale(Math.max(ohlc.open, ohlc.close)),\n\t\t\t\t\ty3 = yScale(Math.min(ohlc.open, ohlc.close)),\n\t\t\t\t\ty4 = yScale(ohlc.low);\n\n\t\t\t\treturn {\n\t\t\t\t\tx,\n\t\t\t\t\ty1,\n\t\t\t\t\ty2,\n\t\t\t\t\ty3,\n\t\t\t\t\ty4,\n\t\t\t\t\tclassName: className(ohlc),\n\t\t\t\t\tdirection: (ohlc.close - ohlc.open),\n\t\t\t\t\tstroke: wickStroke(ohlc),\n\t\t\t\t};\n\t\t\t});\n\treturn wickData;\n}\n*/\n\nfunction getCandleData(props, xAccessor, xScale, yScale, plotData) {\n\n\tconst { wickStroke: wickStrokeProp } = props;\n\tconst wickStroke = functor(wickStrokeProp);\n\n\tconst { classNames, fill: fillProp, stroke: strokeProp, yAccessor } = props;\n\tconst className = functor(classNames);\n\n\tconst fill = functor(fillProp);\n\tconst stroke = functor(strokeProp);\n\n\tconst widthFunctor = functor(props.width);\n\tconst width = widthFunctor(props, {\n\t\txScale,\n\t\txAccessor,\n\t\tplotData\n\t});\n\n\t/*\n\tconst candleWidth = Math.round(width);\n\tconst offset = Math.round(candleWidth === 1 ? 0 : 0.5 * width);\n\t*/\n\tconst trueOffset = 0.5 * width;\n\tconst offset = trueOffset > 0.7\n\t\t? Math.round(trueOffset)\n\t\t: Math.floor(trueOffset);\n\n\t// eslint-disable-next-line prefer-const\n\tlet candles = [];\n\n\tfor (let i = 0; i < plotData.length; i++) {\n\t\tconst d = plotData[i];\n\t\tif (isDefined(yAccessor(d).close)) {\n\t\t\tconst x = Math.round(xScale(xAccessor(d)));\n\t\t\t// const x = Math.round(xScale(xAccessor(d)) - offset);\n\n\t\t\tconst ohlc = yAccessor(d);\n\t\t\tconst y = Math.round(yScale(Math.max(ohlc.open, ohlc.close)));\n\t\t\tconst height = Math.round(Math.abs(yScale(ohlc.open) - yScale(ohlc.close)));\n\n\t\t\tcandles.push({\n\t\t\t\t// type: \"line\"\n\t\t\t\tx: x - offset,\n\t\t\t\ty: y,\n\t\t\t\twick: {\n\t\t\t\t\tstroke: wickStroke(ohlc),\n\t\t\t\t\tx: x,\n\t\t\t\t\ty1: Math.round(yScale(ohlc.high)),\n\t\t\t\t\ty2: y,\n\t\t\t\t\ty3: y + height, // Math.round(yScale(Math.min(ohlc.open, ohlc.close))),\n\t\t\t\t\ty4: Math.round(yScale(ohlc.low)),\n\t\t\t\t},\n\t\t\t\theight: height,\n\t\t\t\twidth: offset * 2,\n\t\t\t\tclassName: className(ohlc),\n\t\t\t\tfill: fill(ohlc),\n\t\t\t\tstroke: stroke(ohlc),\n\t\t\t\tdirection: (ohlc.close - ohlc.open),\n\t\t\t});\n\t\t}\n\t}\n\n\treturn candles;\n}\n\nexport default CandlestickSeries;\n"]}